<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>json-server 伪造接口数据 « 王明川的个人站</title>
  <meta name="description" content="json-server伪造接口数据通过json-server伪造假接口数据，让前端摆脱过度依赖后端接口的开发方式，从而达到前后分离同步开发。在本文中主要涉及mockjs,以及json-server的配置使用，需要对react基础有一定的认识，对模拟数据进行真实请求访问">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000/json-server/2017/11/22">
  <link rel="alternate" type="application/rss+xml" title="王明川的个人站" href="http://localhost:4000/feed.xml" />
</head>


  <body>

    <div class="header-placeholder"></div>
<header class="header">
  <div class="wrapper">
    <div id="sidebar-toggle">TOC</div>
    <a class="site-title" href="/">王明川的个人站</a>
    <nav class="site-nav">
      
        
        <a class="page-link" href="/about/">关于我</a>
      
        
        <a class="page-link" href="/category/">目录</a>
      
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">json-server 伪造接口数据</h1>
    <p class="post-meta">Nov 22, 2017</p>
  </header>

  <article class="post-content">
    <h4 id="json-server伪造接口数据">json-server伪造接口数据</h4>

<p>通过json-server伪造假接口数据，让前端摆脱过度依赖后端接口的开发方式，从而达到前后分离同步开发。在本文中主要涉及mockjs,以及json-server的配置使用，需要对react基础有一定的认识，对模拟数据进行真实请求访问</p>

<!--more-->
<h4 id="首先构建一个简单的react应用页面">首先构建一个简单的react应用页面</h4>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//项目结构</span>
<span class="o">|---</span><span class="nx">node_module</span>
<span class="o">|---</span><span class="nx">src</span>
    <span class="o">|----</span><span class="nx">app</span><span class="p">.</span><span class="nx">js</span>
<span class="o">|---</span><span class="nx">index</span><span class="p">.</span><span class="nx">html</span>
<span class="o">|---</span><span class="kr">package</span><span class="p">.</span><span class="nx">json</span>
<span class="o">|---</span><span class="nx">webpack</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">js</span>
<span class="o">|---</span><span class="p">.</span><span class="nx">babelrc</span>
</code></pre>
</div>

<h4 id="packagejson">package.json</h4>

<blockquote>
  <p>在这个文件中主要是依赖的一些包，主要是你在babel环境运行es6以及react的依赖包，这里关于构建react页面以及运行环境不作详细陈述，其中.babelrc文件必不可少</p>
</blockquote>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"json-server"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"伪造数据"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index.js"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webpack-dev-server --port 5000"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"maic"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISC"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"babel-core"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babel-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.4.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babel-preset-es2015"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"babel-preset-react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.24.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"jquery"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.2.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"json-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.5.4"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"json-server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.10.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mock"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"mockjs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.0.1-beta3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"stylus-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"webpack"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.3.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"webpack-dev-server"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.14.1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"babel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.23.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"css-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.28.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"postcss-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.3.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"postcss-modules-values"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.2.2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rc-calendar"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^8.1.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"rc-time-picker"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^2.3.4"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^15.5.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react-bootstrap"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.30.8"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react-css-modules"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react-dom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^15.5.3"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"react-router-dom"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.1.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"style-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.16.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"stylus"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.54.5"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"stylus-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^3.0.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"url-loader"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^0.5.8"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<h4 id="indexjs">index.js</h4>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"Generator"</span> <span class="na">content=</span><span class="s">"EditPlus®"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"Author"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"Keywords"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"Description"</span> <span class="na">content=</span><span class="s">""</span><span class="nt">&gt;</span>
  <span class="nt">&lt;title&gt;</span>json-server<span class="nt">&lt;/title&gt;</span>
 <span class="nt">&lt;/head&gt;</span>
 <span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"app"</span><span class="nt">&gt;&lt;/div&gt;</span>
    //这里的路径要与webpack.config.js中的output路径保持一致
	<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"./build.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
 <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<h4 id="webpackconfigjson">webpack.config.json</h4>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">entry</span><span class="p">:</span><span class="nx">__dirname</span><span class="o">+</span><span class="s2">"/src/app.js"</span><span class="p">,</span>
	<span class="na">output</span><span class="p">:{</span>
		<span class="na">filename</span><span class="p">:</span><span class="s2">"build.js"</span><span class="c1">//打包输出后的文件名</span>
	<span class="p">},</span>
	<span class="na">module</span><span class="p">:{</span>
		<span class="na">loaders</span><span class="p">:[</span>
		   <span class="p">{</span>
			 <span class="na">test</span><span class="p">:</span><span class="sr">/</span><span class="se">\.</span><span class="sr">json$/</span><span class="p">,</span>
			 <span class="na">loader</span><span class="p">:</span> <span class="s2">"json-loader"</span><span class="p">,</span><span class="c1">//这里必须是json-loader(加载json数据使用)</span>
			<span class="p">},</span>
			<span class="p">{</span>
			   <span class="na">test</span><span class="p">:</span><span class="sr">/</span><span class="se">\.</span><span class="sr">js$/</span><span class="p">,</span>
			   <span class="na">exclude</span><span class="p">:</span><span class="sr">/node_modules/</span><span class="p">,</span>
			   <span class="na">loader</span><span class="p">:</span><span class="s1">'babel-loader'</span><span class="p">,</span>
			   <span class="na">query</span><span class="p">:{</span>
				  <span class="na">presets</span><span class="p">:[</span><span class="s1">'es2015'</span><span class="p">,</span><span class="s1">'react'</span><span class="p">]</span>	
			   <span class="p">}</span>
			<span class="p">},</span>
			<span class="p">{</span>
			  <span class="na">test</span><span class="p">:</span><span class="sr">/</span><span class="se">\.</span><span class="sr">css$/</span><span class="p">,</span>
			  <span class="c1">//loader:"style-loader!css-loader?modules"</span>
			  <span class="c1">//loader: "style-loader!css-loader?modules&amp;localIdentName=[path]-[hash:base64:5]"</span>
			  <span class="na">loader</span><span class="p">:</span> <span class="s2">"style-loader!css-loader"</span>
			<span class="p">},</span>
			<span class="p">{</span>
				<span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.</span><span class="sr">styl/</span><span class="p">,</span>
	        	<span class="na">loader</span><span class="p">:</span> <span class="s1">'style-loader!css-loader?modules&amp;localIdentName=[local]-[hash:base64:5]!stylus-loader'</span>
	      	<span class="p">},</span>
	      	<span class="p">{</span>
				<span class="na">test</span><span class="p">:</span> <span class="sr">/</span><span class="se">\.(</span><span class="sr">png|jpg|gif|woff|woff2</span><span class="se">)</span><span class="sr">$/</span><span class="p">,</span>
	        	<span class="na">loader</span><span class="p">:</span> <span class="s1">'url-loader?limit=8192'</span><span class="c1">//css中加载图片使用的插件，url-loader</span>
	      	<span class="p">}</span>
		<span class="p">]</span>
	<span class="p">},</span>
	 <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
		<span class="na">contentBase</span><span class="p">:</span> <span class="s2">"./"</span><span class="p">,</span><span class="c1">//这里配置影响入口文件</span>
		<span class="na">colors</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">historyApiFallback</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="na">inline</span><span class="p">:</span> <span class="kc">true</span>
	 <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h4 id="入口appjs文件">入口app.js文件</h4>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s2">"react"</span>
<span class="kr">import</span> <span class="nx">ReactDom</span> <span class="nx">from</span> <span class="s2">"react-dom"</span>
<span class="kr">class</span> <span class="nx">Main</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span><span class="p">{</span>
	<span class="nx">constructor</span><span class="p">(</span><span class="nx">props</span><span class="p">){</span>
		<span class="kr">super</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
	<span class="p">}</span>
  <span class="nx">getData</span><span class="p">(){</span>
    <span class="c1">//alert(1111)</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">(</span><span class="s1">'http://localhost:3002/mynewslist'</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">res</span><span class="p">)</span><span class="o">=&gt;</span><span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>
	<span class="nx">render</span><span class="p">(){</span>
		<span class="k">return</span> <span class="p">(</span>
			<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="s2">"main"</span><span class="o">&gt;</span>
				<span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s1">'button'</span> <span class="nx">value</span><span class="o">=</span><span class="s2">"获取数据"</span> <span class="nx">onClick</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">getData</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)}</span><span class="sr">/</span><span class="err">&gt;
</span>			<span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>		<span class="p">)</span>
	<span class="p">}</span>

<span class="p">}</span>
<span class="nx">ReactDom</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">Main</span><span class="o">/&gt;</span><span class="p">,</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'app'</span><span class="p">))</span>
</code></pre>
</div>

<ul>
  <li>新建mock/data.json</li>
</ul>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>  <span class="p">{</span>
    <span class="s2">"news"</span><span class="err">:</span><span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"曹县宣布昨日晚间登日成功"</span><span class="p">,</span>
        <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2016-08-12"</span><span class="p">,</span>
        <span class="s2">"likes"</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
        <span class="s2">"views"</span><span class="p">:</span> <span class="mi">100086</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"长江流域首次发现海豚"</span><span class="p">,</span>
        <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2016-08-12"</span><span class="p">,</span>
        <span class="s2">"likes"</span><span class="p">:</span> <span class="mi">505</span><span class="p">,</span>
        <span class="s2">"views"</span><span class="p">:</span> <span class="mi">9800</span>
      <span class="p">}</span>
    <span class="p">],</span>  
    <span class="s2">"comments"</span><span class="err">:</span><span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"news_id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"支持党中央决定"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="s2">"抄写党章势在必行！"</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>
    <p>npm install json-server</p>
  </li>
  <li>
    <p>在package.json 的script中配置json-server</p>
  </li>
</ul>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w">    </span><span class="s2">"scripts"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"webpack-dev-server --port 5000"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"mock"</span><span class="p">:</span><span class="w"> </span><span class="s2">"json-server ./mock/data.json --port 3002"</span><span class="p">,</span><span class="err">//json-server模拟的端口号</span><span class="w">
      </span><span class="err">}</span><span class="w">
</span></code></pre>
</div>

<ul>
  <li>在配置json-server 中有这样的一些配置参数</li>
</ul>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>    <span class="nx">json</span><span class="o">-</span><span class="nx">server</span> <span class="o">&lt;</span><span class="nx">source</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">option</span><span class="o">&gt;</span>
    <span class="nx">options</span>
       <span class="o">--</span><span class="nx">config</span><span class="p">,</span> <span class="o">-</span><span class="nx">c</span>       <span class="err">指定</span> <span class="nx">config</span> <span class="err">文件</span>                  <span class="p">[</span><span class="err">默认:</span> <span class="s2">"json-server.json"</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">port</span><span class="p">,</span> <span class="o">-</span><span class="nx">p</span>         <span class="err">设置端口号</span>                                   <span class="p">[</span><span class="k">default</span><span class="err">:</span> <span class="mi">3000</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">host</span><span class="p">,</span> <span class="o">-</span><span class="nx">H</span>         <span class="err">设置主机</span>                                   <span class="p">[</span><span class="err">默认:</span> <span class="s2">"0.0.0.0"</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">watch</span><span class="p">,</span> <span class="o">-</span><span class="nx">w</span>        <span class="err">监控文件</span>                                           <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">routes</span><span class="p">,</span> <span class="o">-</span><span class="nx">r</span>       <span class="err">指定路由文件</span>
      <span class="o">--</span><span class="kr">static</span><span class="p">,</span> <span class="o">-</span><span class="nx">s</span>       <span class="err">设置静态文件</span>
      <span class="o">--</span><span class="nx">read</span><span class="o">-</span><span class="nx">only</span><span class="p">,</span> <span class="o">--</span><span class="nx">ro</span>  <span class="err">只允许</span> <span class="nx">GET</span> <span class="err">请求</span>                                    <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">cors</span><span class="p">,</span> <span class="o">--</span><span class="nx">nc</span>    <span class="err">禁止跨域资源共享</span>                                   <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">gzip</span><span class="p">,</span> <span class="o">--</span><span class="nx">ng</span>    <span class="err">禁止</span><span class="nx">GZIP</span>                                          <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">snapshots</span><span class="p">,</span> <span class="o">-</span><span class="nx">S</span>    <span class="err">设置快照目录</span>                                     <span class="p">[</span><span class="err">默认:</span> <span class="s2">"."</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">delay</span><span class="p">,</span> <span class="o">-</span><span class="nx">d</span>        <span class="err">设置反馈延时</span> <span class="p">(</span><span class="nx">ms</span><span class="p">)</span>
      <span class="o">--</span><span class="nx">id</span><span class="p">,</span> <span class="o">-</span><span class="nx">i</span>           <span class="err">设置数据的</span><span class="nx">id</span><span class="err">属性</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span> <span class="nx">_id</span><span class="p">)</span>                     <span class="p">[</span><span class="err">默认:</span> <span class="s2">"id"</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">quiet</span><span class="p">,</span> <span class="o">-</span><span class="nx">q</span>        <span class="err">不输出日志信息</span>                                     <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">help</span><span class="p">,</span> <span class="o">-</span><span class="nx">h</span>         <span class="err">显示帮助信息</span>                                       <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
      <span class="o">--</span><span class="nx">version</span><span class="p">,</span> <span class="o">-</span><span class="nx">v</span>      <span class="err">显示版本号</span>                                         <span class="p">[</span><span class="kr">boolean</span><span class="p">]</span>
</code></pre>
</div>

<ul>
  <li>运行npm run mock 浏览器中输入 localhost:3002/mynewslist</li>
</ul>

<p><img src="/images/jsonserver/1.png" alt="" /></p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code>  <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"曹县宣布昨日晚间登日成功"</span><span class="p">,</span>
      <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2016-08-12"</span><span class="p">,</span>
      <span class="s2">"likes"</span><span class="p">:</span> <span class="mi">55</span><span class="p">,</span>
      <span class="s2">"views"</span><span class="p">:</span> <span class="mi">100086</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"id"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
      <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"长江流域首次发现海豚"</span><span class="p">,</span>
      <span class="s2">"date"</span><span class="p">:</span> <span class="s2">"2016-08-12"</span><span class="p">,</span>
      <span class="s2">"likes"</span><span class="p">:</span> <span class="mi">505</span><span class="p">,</span>
      <span class="s2">"views"</span><span class="p">:</span> <span class="mi">9800</span>
    <span class="p">}</span>
  <span class="p">]</span>
</code></pre>
</div>

<p>当我们在app.js页面中点击按钮时，此时会发生ajax请求，那么也会证实我们利用json-server模拟的数据没有错误</p>

<p>#### 如何结合mock.js造json假数据</p>

<ul>
  <li>在mock目录下新建draw.js,mockserver.js和routers.json</li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="c1">//draw.js</span>
<span class="kd">let</span> <span class="nx">Mock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mockjs'</span><span class="p">);</span><span class="c1">//引入mockjs</span>
<span class="kd">let</span> <span class="nx">Random</span> <span class="o">=</span> <span class="nx">Mock</span><span class="p">.</span><span class="nx">Random</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">createData</span><span class="p">(){</span>
	<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="na">total</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span>
		<span class="na">data</span><span class="p">:[]</span>
	<span class="p">}</span> 
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
		<span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Mock</span><span class="p">.</span><span class="nx">mock</span><span class="p">({</span>
			<span class="na">id</span><span class="p">:</span> <span class="nx">i</span><span class="p">,</span>
			<span class="na">createTime</span><span class="p">:</span> <span class="nx">Random</span><span class="p">.</span><span class="nx">date</span><span class="p">(</span><span class="s1">'T'</span><span class="p">),</span>
			<span class="na">text</span><span class="p">:</span> <span class="nx">Random</span><span class="p">.</span><span class="nx">cword</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
			<span class="na">number</span><span class="p">:</span> <span class="nx">Random</span><span class="p">.</span><span class="nx">integer</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
		<span class="p">}))</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">data</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">create</span><span class="p">;</span>
</code></pre>
</div>
<ul>
  <li>mockserver.js</li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">draw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./draw.js'</span><span class="p">);</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">data</span><span class="p">(){</span>
	<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">data</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="nx">draw</span><span class="p">();</span><span class="c1">//这里的data.draw 与routers.json中的'/draw'对应</span>
	<span class="k">return</span> <span class="nx">data</span>
<span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>routers.json</li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
   <span class="s2">"/ucs/draw/list.do"</span><span class="err">:</span> <span class="s2">"/draw"</span>
<span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>在package.json中的script中配置加上mockrouter</li>
</ul>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="s2">"scripts"</span><span class="err">:</span> <span class="p">{</span>
    <span class="s2">"test"</span><span class="err">:</span> <span class="s2">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span class="p">,</span>
    <span class="s2">"start"</span><span class="err">:</span> <span class="s2">"webpack-dev-server --port 5000"</span><span class="p">,</span>
    <span class="s2">"mock"</span><span class="err">:</span> <span class="s2">"json-server ./mock/data.json --port 3002"</span><span class="p">,</span>
    <span class="s2">"mockrouter"</span><span class="err">:</span> <span class="s2">"json-server --watch ./mock/mockserver.js --port 3023 --routes ./mock/routers.json"</span>
  <span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>运行 npm run mockserver  浏览器中输入localhost:3023/draw或者loclost:3023/ucs/draw/list.do</li>
</ul>

<p><img src="/images/jsonserver/2.png" alt="" />
<img src="/images/jsonserver/3.png" alt="" /></p>

<ul>
  <li>当我们需要模拟多个接口时，只需要类似新建一个draw.js文件即可，比如新建point.js
    <div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">Mock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'mockjs'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">Random</span> <span class="o">=</span> <span class="nx">Mock</span><span class="p">.</span><span class="nx">Random</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">createData</span><span class="p">(){</span>
  <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">total</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span>
      <span class="na">data</span><span class="p">:[]</span>
  <span class="p">}</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">data</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Mock</span><span class="p">.</span><span class="nx">mock</span><span class="p">({</span>
          <span class="na">id</span><span class="p">:</span> <span class="nx">i</span><span class="p">,</span>
          <span class="na">createTime</span><span class="p">:</span> <span class="nx">Random</span><span class="p">.</span><span class="nx">date</span><span class="p">(</span><span class="s1">'T'</span><span class="p">),</span>
          <span class="na">img</span><span class="p">:</span> <span class="nx">Random</span><span class="p">.</span><span class="nx">image</span><span class="p">(</span><span class="s1">'200x300'</span><span class="p">),</span>
          <span class="na">number</span><span class="p">:</span> <span class="nx">Random</span><span class="p">.</span><span class="nx">integer</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
      <span class="p">}))</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">data</span>
<span class="p">}</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">create</span><span class="p">;</span>
</code></pre>
    </div>
  </li>
</ul>

<p>然后在mockserver.js</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">draw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./draw.js'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./point'</span><span class="p">);</span><span class="c1">//引入point</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">data</span><span class="p">(){</span>
	<span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">data</span><span class="p">.</span><span class="nx">draw</span> <span class="o">=</span> <span class="nx">draw</span><span class="p">();</span>
	<span class="nx">data</span><span class="p">.</span><span class="nx">point</span> <span class="o">=</span> <span class="nx">point</span><span class="p">();</span>

	<span class="k">return</span> <span class="nx">data</span>
<span class="p">}</span>
</code></pre>
</div>

<p>routers.json中</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
   <span class="s2">"/ucs/draw/list.do"</span><span class="err">:</span> <span class="s2">"/draw"</span><span class="p">,</span>
   <span class="s2">"/ucs/point/list.do"</span><span class="err">:</span> <span class="s2">"/point"</span>
<span class="p">}</span>
</code></pre>
</div>

<p>重启模拟接口服务 localhst:3023/ucs/point/list.do</p>

<p><img src="/images/jsonserver/4.png" alt="" />
<img src="/images/jsonserver/5.png" alt="" /></p>
<h4 id="小结">小结</h4>

<ul>
  <li>主要是利用json-server模拟端口，在react中构建基础页面时，注意输出output文件与webpack.config.js配置中基础devServer的contentBase配置要保持一致</li>
  <li>在使用mockjs和json-server的前提下要安装基本的相关依赖包</li>
  <li>在package.json文件的scripts内容，注意json-server 的一些端口，路由参数配置</li>
  <li>关于模拟接口文件,draw.js中主要依赖mock库产生的随机数,在mockserver.js文件中要引入相关接口</li>
</ul>

  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="https://maicFir.github.io/images/avatar.jpg" alt="王明川">
  <div class="col-box-title name">王明川</div>
  <p>奋斗的状态是追求理想的一种</p>
  <p class="contact">
    
    
    
    <a href="mcodes@163.com">Email</a>
    
    <a href="https://github.com/maicFir">GitHub</a>
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">Newest Posts</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/react/2017/12/01">react父子组件通信以及生命周期</a></li>
    
      <li><a class="post-link" href="/json-server/2017/11/22">json-server 伪造接口数据</a></li>
    
      <li><a class="post-link" href="/react/2017/10/26">react-router 进阶</a></li>
    
      <li><a class="post-link" href="/nodejs/2017/10/15">关于nodejs的认识</a></li>
    
      <li><a class="post-link" href="/es6/2017/06/25">es6学习笔记</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">
  <div class="col-box-title">TOC</div>
</div>

        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2016 王明川
</div>
</footer>

<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script>
<script src="/js/easybook.js"></script>


  </body>

</html>
