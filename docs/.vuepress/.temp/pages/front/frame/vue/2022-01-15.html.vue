<template><div><p><code v-pre>vue组合式</code>是<code v-pre>vue2</code>项目过渡<code v-pre>vue3</code>的一种友好方案，在历史项目逐步迁移到<code v-pre>vue3</code>中，有项目历史包袱原因，一下子升级带来的问题可能比较多，<code v-pre>composition-api</code>天然兼容<code v-pre>vue2</code>,在<code v-pre>vue2</code>中使用<code v-pre>组合式API</code>让你提前感受<code v-pre>vue3</code>的各种姿势，<code v-pre>vue3</code>已经出来 3 年了，都<code v-pre>2022</code>了，<code v-pre>vue</code>祖师爷赏饭吃，相信你跟笔者一样早已跃跃欲试。</p>
<p><img src="https://img.soogif.com/IeWk1WWjT3XDOMWtSB7kgeoWbvaBIBGe.gif?scope=mdnice" alt=""></p>
<p>前段时间，笔者项目已经完成升级<code v-pre>ts</code>、<code v-pre>组合式api</code>,毕竟去年第 4 季度首要<code v-pre>KPI</code>便是升级项目业务引入<code v-pre>ts</code>和<code v-pre>组合式API</code>。在一边搬砖迭代业务，一边升级项目技术栈的挑战，过程虽曲折，好在组内有大佬及时解围，常常遇到奇葩问题，算是少走弯路。本篇不做<code v-pre>组合式API语法</code>过渡解读，因最近一个页面需求优化，以最简单的注册业务为例，在<code v-pre>vue2</code>与<code v-pre>组合式API</code>的选择中，希望给你的项目升级的过程中带来一点点帮助和思考。</p>
<p>正文开始...</p>
<h3 id="注册页面" tabindex="-1"><a class="header-anchor" href="#注册页面" aria-hidden="true">#</a> 注册页面</h3>
<p>这是一个非常普通的一个注册流程，可以看下具体页面，<code v-pre>第一步账号注册</code>
<img src="https://files.mdnice.com/user/24614/3c066083-baab-416d-8e67-7b14fed9e268.jpg" alt=""></p>
<h3 id="信息登记" tabindex="-1"><a class="header-anchor" href="#信息登记" aria-hidden="true">#</a> 信息登记</h3>
<p>这是完成注册后，需要登记信息<code v-pre>第二步信息登记</code>
<img src="https://files.mdnice.com/user/24614/bf23769f-8dba-4504-a58e-13f30b82ced3.jpg" alt=""></p>
<h3 id="等待审核" tabindex="-1"><a class="header-anchor" href="#等待审核" aria-hidden="true">#</a> 等待审核</h3>
<p>在第二步完成信息登记成功后，便等待管理员审核便可成功登陆控制台
<img src="https://files.mdnice.com/user/24614/572d56c3-78af-420d-af0c-0dbcdf2a536a.jpg" alt=""></p>
<h3 id="看下未升级之前的代码-vue2-版本" tabindex="-1"><a class="header-anchor" href="#看下未升级之前的代码-vue2-版本" aria-hidden="true">#</a> 看下未升级之前的代码（vue2）版本</h3>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Index.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
  <span class="token operator">&lt;</span>a<span class="token operator">-</span>base<span class="token operator">-</span>page<span class="token operator">-</span>layout<span class="token operator">></span>
    <span class="token operator">&lt;</span>i<span class="token operator">-</span>card <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"page-content-card"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>i<span class="token operator">-</span>steps <span class="token operator">:</span>current<span class="token operator">=</span><span class="token string">"currentStep"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>i<span class="token operator">-</span>step v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"step of steps"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"step.value"</span> <span class="token operator">:</span>title<span class="token operator">=</span><span class="token string">"$t(step.label)"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>step<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>steps<span class="token operator">></span>
      <span class="token operator">&lt;</span>i<span class="token operator">-</span>divider<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>divider<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>注册<span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>a<span class="token operator">-</span>register v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"currentStep === 0"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-one"</span> @finish<span class="token operator">=</span><span class="token string">"finishRegister"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>register<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>信息登记<span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>a<span class="token operator">-</span>info v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"currentStep === 1"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-two"</span> @finish<span class="token operator">=</span><span class="token string">"finishRegisterInfo"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>info<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>等待审核<span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>a<span class="token operator">-</span>moderation v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"currentStep === 2"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-three"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>moderation<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>card<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>base<span class="token operator">-</span>page<span class="token operator">-</span>layout<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Index.vue</span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> auth <span class="token keyword">from</span> <span class="token string">'@/service/auth'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> BasePageLayout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/components'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Register <span class="token keyword">from</span> <span class="token string">'./Register'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Info <span class="token keyword">from</span> <span class="token string">'./Info'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Moderation <span class="token keyword">from</span> <span class="token string">'./Moderation'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ABasePageLayout</span><span class="token operator">:</span> BasePageLayout<span class="token punctuation">,</span>
    <span class="token literal-property property">ARegister</span><span class="token operator">:</span> Register<span class="token punctuation">,</span>
    <span class="token literal-property property">AInfo</span><span class="token operator">:</span> Info<span class="token punctuation">,</span>
    <span class="token literal-property property">AModeration</span><span class="token operator">:</span> Moderation<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">currentStep</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">steps</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'register.steps.one'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'register.steps.two'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'register.steps.three'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">finishRegister</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>developerInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>developerInfo<span class="token punctuation">.</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$Message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.message.registerd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          auth<span class="token punctuation">.</span><span class="token function">goLogin</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currentStep <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentStep <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">finishRegisterInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentStep <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> step <span class="token operator">=</span> <span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>step<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>step<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentStep <span class="token operator">=</span> step<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currentStep <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上是<code v-pre>index.vue</code>,模板和逻辑是常用的<code v-pre>options</code>和<code v-pre>template</code>方式，在<code v-pre>vue2</code>中看起来似乎没毛病。</p>
<p>我们在继续关注第一步<code v-pre>Register.vue</code>，具体代码如下：</p>
<p><code v-pre>模板代码</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Register.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
  <span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>i<span class="token operator">-</span>alert <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"warm-prompt-alert"</span> show<span class="token operator">-</span>icon closable<span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"warm-prompt-tips"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.warmPrompt.title'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>span slot<span class="token operator">=</span><span class="token string">"desc"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.warmPrompt.content'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>alert<span class="token operator">></span>
    <span class="token operator">&lt;</span>i<span class="token operator">-</span>row<span class="token operator">></span>
      <span class="token operator">&lt;</span>i<span class="token operator">-</span>col span<span class="token operator">=</span><span class="token string">"12"</span> offset<span class="token operator">=</span><span class="token string">"6"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>i<span class="token operator">-</span>tabs<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 手机号注册 <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>tab<span class="token operator">-</span>pane <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.tabs.phone')"</span> icon<span class="token operator">=</span><span class="token string">"ios-phone-portrait"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>form
              <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">"registerPhoneForm"</span>
              ref<span class="token operator">=</span><span class="token string">"registerPhoneForm"</span>
              <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">"phoneRuleValidate"</span>
              <span class="token operator">:</span>label<span class="token operator">-</span>width<span class="token operator">=</span><span class="token string">"140"</span>
            <span class="token operator">></span>
              <span class="token operator">&lt;</span>a<span class="token operator">-</span>fixed<span class="token operator">-</span>autofill<span class="token operator">-</span>password<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>fixed<span class="token operator">-</span>autofill<span class="token operator">-</span>password<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.phone.label')"</span> prop<span class="token operator">=</span><span class="token string">"phone"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerPhoneForm.phone"</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.phone.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.password.label')"</span> prop<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  type<span class="token operator">=</span><span class="token string">"password"</span>
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerPhoneForm.password"</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.password.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.rpassword.label')"</span> prop<span class="token operator">=</span><span class="token string">"rpassword"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  type<span class="token operator">=</span><span class="token string">"password"</span>
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerPhoneForm.rpassword"</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.rpassword.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.authCode.label')"</span> prop<span class="token operator">=</span><span class="token string">"authCode"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>row type<span class="token operator">=</span><span class="token string">"flex"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"authcode-row"</span><span class="token operator">></span>
                  <span class="token operator">&lt;</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                    <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                      v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerPhoneForm.authCode"</span>
                      <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.authCode.placeholder')"</span>
                    <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                  <span class="token operator">&lt;</span>i<span class="token operator">-</span>col <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"padding-left-16"</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>vcode<span class="token operator">-</span>button
                      @send<span class="token operator">-</span>code<span class="token operator">=</span><span class="token string">"sendCode('phone')"</span>
                      <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"!registerPhoneForm.phone"</span>
                    <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>vcode<span class="token operator">-</span>button<span class="token operator">></span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>row<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>checkbox v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerPhoneForm.agreeAndComply"</span><span class="token operator">></span>
                  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.agreeAndComply'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span>a @click<span class="token operator">=</span><span class="token string">"handleProtal('/user-agreement')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>
                    <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.userAgreement'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
                  与
                  <span class="token operator">&lt;</span>a @click<span class="token operator">=</span><span class="token string">"handleProtal('/privacy-policy')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>
                    <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.privacyPolicy'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>checkbox<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>button
                  type<span class="token operator">=</span><span class="token string">"primary"</span>
                  @click<span class="token operator">=</span><span class="token string">"submitPhoneForm"</span>
                  <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"!registerPhoneForm.agreeAndComply"</span>
                <span class="token operator">></span>
                  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.submitButtonLabel'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>button<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>tab<span class="token operator">-</span>pane<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 邮箱注册 <span class="token operator">--</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>tab<span class="token operator">-</span>pane <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.tabs.email')"</span> icon<span class="token operator">=</span><span class="token string">"ios-mail"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>form
              <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">"registerEmailForm"</span>
              ref<span class="token operator">=</span><span class="token string">"registerEmailForm"</span>
              <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">"emailRuleValidate"</span>
              <span class="token operator">:</span>label<span class="token operator">-</span>width<span class="token operator">=</span><span class="token string">"140"</span>
            <span class="token operator">></span>
              <span class="token operator">&lt;</span>a<span class="token operator">-</span>fixed<span class="token operator">-</span>autofill<span class="token operator">-</span>password<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>fixed<span class="token operator">-</span>autofill<span class="token operator">-</span>password<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.email.label')"</span> prop<span class="token operator">=</span><span class="token string">"email"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerEmailForm.email"</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.email.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.password.label')"</span> prop<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  type<span class="token operator">=</span><span class="token string">"password"</span>
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerEmailForm.password"</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.password.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.rpassword.label')"</span> prop<span class="token operator">=</span><span class="token string">"rpassword"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  type<span class="token operator">=</span><span class="token string">"password"</span>
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerEmailForm.rpassword"</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.rpassword.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.authCode.label')"</span> prop<span class="token operator">=</span><span class="token string">"authCode"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>row type<span class="token operator">=</span><span class="token string">"flex"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"authcode-row"</span><span class="token operator">></span>
                  <span class="token operator">&lt;</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                    <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                      v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerEmailForm.authCode"</span>
                      <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.authCode.placeholder')"</span>
                    <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                  <span class="token operator">&lt;</span>i<span class="token operator">-</span>col <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"padding-left-16"</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>a<span class="token operator">-</span>vcode<span class="token operator">-</span>button
                      @send<span class="token operator">-</span>code<span class="token operator">=</span><span class="token string">"sendCode('email')"</span>
                      <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"!registerEmailForm.email"</span>
                    <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>vcode<span class="token operator">-</span>button<span class="token operator">></span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>row<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>checkbox v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"registerEmailForm.agreeAndComply"</span><span class="token operator">></span>
                  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.agreeAndComply'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span>a @click<span class="token operator">=</span><span class="token string">"handleProtal('/user-agreement')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>
                    <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.userAgreement'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
                  与
                  <span class="token operator">&lt;</span>a @click<span class="token operator">=</span><span class="token string">"handleProtal('/privacy-policy')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>
                    <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.privacyPolicy'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>checkbox<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>button
                  type<span class="token operator">=</span><span class="token string">"primary"</span>
                  @click<span class="token operator">=</span><span class="token string">"submitEmailForm"</span>
                  <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"!registerEmailForm.agreeAndComply"</span>
                <span class="token operator">></span>
                  <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.submitButtonLabel'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>button<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>tab<span class="token operator">-</span>pane<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>tabs<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>row<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>js代码</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Register.vue</span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> md5 <span class="token keyword">from</span> <span class="token string">'blueimp-md5'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> commonRegexp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/index'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> VcodeButton<span class="token punctuation">,</span> FixedAutofillPassword <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/components'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> handlegetRegistVCodeProxy<span class="token punctuation">,</span> handleRegisterProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/service/proxy/index'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">AVcodeButton</span><span class="token operator">:</span> VcodeButton<span class="token punctuation">,</span>
    <span class="token literal-property property">AFixedAutofillPassword</span><span class="token operator">:</span> FixedAutofillPassword<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">registerPhoneForm</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">phone</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">rpassword</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">authCode</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">agreeAndComply</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">phoneRuleValidate</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">phone</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.phone.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">MOBILE_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.phone.regCheckMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.password.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">PASSWORD_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.password.regCheckMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">rpassword</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.rpassword.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registerPhoneForm<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.rpassword.notMatchMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">authCode</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.authCode.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">registerEmailForm</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">rpassword</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">authCode</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">agreeAndComply</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">emailRuleValidate</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.email.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">EMAIL_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.email.regCheckMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.password.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">PASSWORD_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.password.regCheckMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">rpassword</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.rpassword.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registerEmailForm<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.rpassword.notMatchMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">authCode</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.authCode.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">handleProtal</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">sendCode</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'phone'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span>phoneNum <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registerPhoneForm<span class="token punctuation">.</span>phone<span class="token punctuation">;</span>
        params<span class="token punctuation">.</span>countryCode <span class="token operator">=</span> <span class="token string">'+86'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'email'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span>email <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registerEmailForm<span class="token punctuation">.</span>email<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      params<span class="token punctuation">.</span>authCodeType <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 0 注册 1验证码登陆 2 找回密码</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">handlegetRegistVCodeProxy</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$Message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'common.message.success'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">_doRegister</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">handleRegisterProxy</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'register'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">submitPhoneForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">registerPhoneForm</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">phone</span><span class="token operator">:</span> account<span class="token punctuation">,</span> password<span class="token punctuation">,</span> authCode <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>registerPhoneForm<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">valid</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
            account<span class="token punctuation">,</span>
            <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token function">md5</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span>
            authCode<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_doRegister</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">submitEmailForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">registerEmailForm</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">email</span><span class="token operator">:</span> account<span class="token punctuation">,</span> password<span class="token punctuation">,</span> authCode <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>registerEmailForm<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">valid</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
            account<span class="token punctuation">,</span>
            <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token function">md5</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span>
            authCode<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_doRegister</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个页面代码如此冗余，我们发现有非常多重复的东西，用了两个<code v-pre>tab</code>切换两种不同方式注册，但实际上发现<code v-pre>手机注册</code>、<code v-pre>邮箱</code>注册最后调用接口都是一样的，所以冗余代码有些多，代码虽长了些，好在能改得动。</p>
<h3 id="升级后代码-组合式-api" tabindex="-1"><a class="header-anchor" href="#升级后代码-组合式-api" aria-hidden="true">#</a> 升级后代码（组合式 API）</h3>
<p>用<code v-pre>jsx</code>与<code v-pre>composition-api</code>重构了这个页面，减少了很多不必要的代码</p>
<p>新重构<code v-pre>Index.vue模板代码</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Index.vue</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"tsx"</span><span class="token operator">></span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> SetupContext<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Qs <span class="token keyword">from</span> <span class="token string">'qs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> auth <span class="token keyword">from</span> <span class="token string">'@/service/auth'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> BasePageLayout <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/components'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useStepConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./hooks'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Register <span class="token keyword">from</span> <span class="token string">'./Register.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Info <span class="token keyword">from</span> <span class="token string">'./Info.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Moderation <span class="token keyword">from</span> <span class="token string">'./Moderation.vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> AuditFail <span class="token keyword">from</span> <span class="token string">'./AuditFail.vue'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ABasePageLayout</span><span class="token operator">:</span> BasePageLayout<span class="token punctuation">,</span>
    <span class="token literal-property property">ARegister</span><span class="token operator">:</span> Register<span class="token punctuation">,</span>
    <span class="token literal-property property">AInfo</span><span class="token operator">:</span> Info<span class="token punctuation">,</span>
    <span class="token literal-property property">AModeration</span><span class="token operator">:</span> Moderation<span class="token punctuation">,</span>
    AuditFail<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token literal-property property">ctx</span><span class="token operator">:</span> SetupContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> currentStep<span class="token punctuation">,</span> steps <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useStepConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> root <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">;</span>
    <span class="token comment">// 完成注册</span>
    <span class="token keyword">const</span> <span class="token function-variable function">finish</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">result</span><span class="token operator">:</span> PlainObj<span class="token punctuation">,</span> <span class="token literal-property property">setType</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setType <span class="token operator">===</span> <span class="token string">'regiter'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>developerInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>developerInfo<span class="token punctuation">.</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            root<span class="token punctuation">.</span>$Message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.message.registerd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            auth<span class="token punctuation">.</span><span class="token function">goLogin</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            root<span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/register?step=2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          root<span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/register?step=1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// const { step, status } = result;</span>
        <span class="token keyword">const</span> params <span class="token operator">=</span> Qs<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">addQueryPrefix</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/register</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> root<span class="token punctuation">.</span>$route<span class="token punctuation">,</span>
      <span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token parameter"><span class="token keyword">void</span></span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{</span> step <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> val<span class="token punctuation">;</span>
        currentStep<span class="token punctuation">.</span>value <span class="token operator">=</span> step <span class="token operator">?</span> <span class="token function">Number</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> step <span class="token operator">=</span> <span class="token operator">+</span>root<span class="token punctuation">.</span>$route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>step<span class="token punctuation">;</span>
      currentStep<span class="token punctuation">.</span>value <span class="token operator">=</span> step <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      currentStep<span class="token punctuation">,</span>
      steps<span class="token punctuation">,</span>
      finish<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> currentStep<span class="token punctuation">,</span> steps<span class="token punctuation">,</span> finish <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token literal-property property">CurentComponent</span><span class="token operator">:</span> any <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span><span class="token parameter">Element</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token literal-property property">ret</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token punctuation">[</span>key<span class="token operator">:</span> number<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">JSX</span><span class="token punctuation">.</span>Element<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token operator">:</span> <span class="token operator">&lt;</span>a<span class="token operator">-</span>register <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-one"</span> onFinish<span class="token operator">=</span><span class="token punctuation">{</span>finish<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>register<span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token number">1</span><span class="token operator">:</span> <span class="token operator">&lt;</span>a<span class="token operator">-</span>info <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-two"</span> onFinish<span class="token operator">=</span><span class="token punctuation">{</span>finish<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>info<span class="token operator">></span><span class="token punctuation">,</span>
        <span class="token number">2</span><span class="token operator">:</span> <span class="token operator">&lt;</span>a<span class="token operator">-</span>moderation <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"step-three"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>moderation<span class="token operator">></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> ret<span class="token punctuation">[</span>currentStep<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"register"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>a<span class="token operator">-</span>base<span class="token operator">-</span>page<span class="token operator">-</span>layout<span class="token operator">></span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>card <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"page-content-card"</span><span class="token operator">></span>
            <span class="token punctuation">{</span>currentStep <span class="token operator">===</span> <span class="token number">3</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>audit<span class="token operator">-</span>fail onFinish<span class="token operator">=</span><span class="token punctuation">{</span>finish<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>audit<span class="token operator">-</span>fail<span class="token operator">></span>
            <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>steps current<span class="token operator">=</span><span class="token punctuation">{</span>currentStep<span class="token punctuation">}</span><span class="token operator">></span>
                  <span class="token punctuation">{</span>steps<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                    <span class="token operator">&lt;</span>i<span class="token operator">-</span>step key<span class="token operator">=</span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>value<span class="token punctuation">}</span> title<span class="token operator">=</span><span class="token punctuation">{</span>v<span class="token punctuation">.</span>label<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>step<span class="token operator">></span>
                  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>steps<span class="token operator">></span>
                <span class="token punctuation">{</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>currentStep<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
                  <span class="token operator">&lt;</span>i<span class="token operator">-</span>divider style<span class="token operator">=</span><span class="token string">"width:auto;min-width:80%;margin:30px 60px;"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>divider<span class="token operator">></span>
                <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>
                <span class="token operator">&lt;</span>CurentComponent <span class="token operator">/</span><span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>card<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>base<span class="token operator">-</span>page<span class="token operator">-</span>layout<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由页面结构来看，其实与未升级前并没有发生多大变化，就是第一步注册操作、第二步信息登记，第三部等待审核。不过注意页面上还有一个状态<code v-pre>currentStep=3</code>的条件，这是一个等待审核被拒绝的页面状态。页面每个步骤的阶段显示都是通过路由的<code v-pre>currentStep</code>来做判断标识。</p>
<p>重构后后新注册页面<code v-pre>模板代码</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Register.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
  <span class="token operator">&lt;</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>i<span class="token operator">-</span>alert <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"warm-prompt-alert"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>span slot<span class="token operator">=</span><span class="token string">"desc"</span><span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.warmPrompt.title'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.warmPrompt.content'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:void(0)"</span> style<span class="token operator">=</span><span class="token string">"color: #4754ff"</span> @click<span class="token operator">=</span><span class="token string">"handleLogin"</span><span class="token operator">></span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.warmPrompt.accountLogin'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>alert<span class="token operator">></span>
    <span class="token operator">&lt;</span>i<span class="token operator">-</span>row<span class="token operator">></span>
      <span class="token operator">&lt;</span>i<span class="token operator">-</span>col span<span class="token operator">=</span><span class="token string">"12"</span> offset<span class="token operator">=</span><span class="token string">"6"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>i<span class="token operator">-</span>form <span class="token operator">:</span>model<span class="token operator">=</span><span class="token string">"formParams"</span> <span class="token operator">:</span>rules<span class="token operator">=</span><span class="token string">"rulesConfig"</span> ref<span class="token operator">=</span><span class="token string">"form"</span> <span class="token operator">:</span>label<span class="token operator">-</span>width<span class="token operator">=</span><span class="token string">"140"</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>a<span class="token operator">-</span>fixed<span class="token operator">-</span>autofill<span class="token operator">-</span>password<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>fixed<span class="token operator">-</span>autofill<span class="token operator">-</span>password<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.useServer.label')"</span> prop<span class="token operator">=</span><span class="token string">"useServer"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>select
              style<span class="token operator">=</span><span class="token string">"width: 320px"</span>
              v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"formParams.useServer"</span>
              <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.useServer.placeholder')"</span>
            <span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>option
                v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"item in useServerListOption"</span>
                <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"item.value"</span>
                <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"item.value"</span>
                <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t(item.label)"</span>
              <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>option<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>select<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.account.label')"</span> prop<span class="token operator">=</span><span class="token string">"account"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
              v<span class="token operator">-</span>model<span class="token punctuation">.</span>trim<span class="token operator">=</span><span class="token string">"formParams.account"</span>
              <span class="token literal-property property">clearable</span>
              <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.account.placeholder')"</span>
            <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.password.label')"</span> prop<span class="token operator">=</span><span class="token string">"password"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
              type<span class="token operator">=</span><span class="token string">"password"</span>
              clearable
              v<span class="token operator">-</span>model<span class="token punctuation">.</span>trim<span class="token operator">=</span><span class="token string">"formParams.password"</span>
              <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.password.placeholder')"</span>
            <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.rpassword.label')"</span> prop<span class="token operator">=</span><span class="token string">"rpassword"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
              type<span class="token operator">=</span><span class="token string">"password"</span>
              clearable
              v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"formParams.rpassword"</span>
              <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.rpassword.placeholder')"</span>
            <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">"$t('register.registerForm.authCode.label')"</span> prop<span class="token operator">=</span><span class="token string">"authCode"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>row type<span class="token operator">=</span><span class="token string">"flex"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"authcode-row"</span><span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>col<span class="token operator">></span>
                <span class="token operator">&lt;</span>i<span class="token operator">-</span>input
                  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"formParams.authCode"</span>
                  <span class="token literal-property property">clearable</span>
                  <span class="token operator">:</span>placeholder<span class="token operator">=</span><span class="token string">"$t('register.registerForm.authCode.placeholder')"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>input<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
              <span class="token operator">&lt;</span>i<span class="token operator">-</span>col <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"padding-left-16"</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>a<span class="token operator">-</span>vcode<span class="token operator">-</span>button
                  <span class="token operator">:</span>sendCode<span class="token operator">=</span><span class="token string">"sendCode"</span>
                  <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"!formParams.account"</span>
                <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>vcode<span class="token operator">-</span>button<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>row<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>checkbox v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"formParams.agreeAndComply"</span><span class="token operator">></span>
              <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.agreeAndComply'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token operator">&lt;</span>a @click<span class="token operator">=</span><span class="token string">"handleProtal('/user-agreement')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>
                <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.userAgreement'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
              与
              <span class="token operator">&lt;</span>a @click<span class="token operator">=</span><span class="token string">"handleProtal('/privacy-policy')"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>
                <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'login.privacyPolicy'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>checkbox<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
          <span class="token operator">&lt;</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
            <span class="token operator">&lt;</span>i<span class="token operator">-</span>button
              style<span class="token operator">=</span><span class="token string">"width: 100%"</span>
              type<span class="token operator">=</span><span class="token string">"primary"</span>
              @click<span class="token operator">=</span><span class="token string">"handleSubmit"</span>
              <span class="token operator">:</span>disabled<span class="token operator">=</span><span class="token string">"!formParams.agreeAndComply"</span>
            <span class="token operator">></span>
              <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.submitButtonLabel'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>button<span class="token operator">></span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">-</span>item<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>form<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>col<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>i<span class="token operator">-</span>row<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们发现模板页面少了邮箱与手机号的区别，这是因为把手机号与邮箱统称为账号了，笔者认为在需求阶段应该就能考虑到，由于接口设计原因，邮箱和手机号为一个字段，但是前端表现形式不一样，譬如涉及邮箱和手机号的正则校验，因此，在需求与编码阶段，你是否会走第一种方案？还是说以后端一个字段设计为准，在视图层里，你不要那么明确的给用户两种方式选择。有更好的选择，如果设计如此，我们可以与产品设计沟通，因为只要你有理由说服了他们，那么就会增加代码的可复用度，降低冗余代码的堆积，从而减少维护成本。</p>
<p>重构后新注册<code v-pre>js代码</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// Register.vue</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">"tsx"</span><span class="token operator">></span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> SetupContext<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Form <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'view-design'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> md5 <span class="token keyword">from</span> <span class="token string">'blueimp-md5'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> commonRegexp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/index'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> VcodeButton<span class="token punctuation">,</span> FixedAutofillPassword <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/components'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> useServerListOptionMinx <span class="token keyword">from</span> <span class="token string">'@/mixins/useServerListOptionMinx'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> handlegetRegistVCodeProxy<span class="token punctuation">,</span> handleRegisterProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/service/proxy/index'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRegister <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./hooks'</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">formParamsType</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">account</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token literal-property property">authCode</span><span class="token operator">:</span> string <span class="token operator">|</span> number<span class="token punctuation">;</span>
  <span class="token literal-property property">useServer</span><span class="token operator">:</span> number <span class="token operator">|</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">AVcodeButton</span><span class="token operator">:</span> VcodeButton<span class="token punctuation">,</span>
    <span class="token literal-property property">AFixedAutofillPassword</span><span class="token operator">:</span> FixedAutofillPassword<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>useServerListOptionMinx<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">props</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">ctx</span><span class="token operator">:</span> SetupContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> formParams<span class="token punctuation">,</span> rules <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> refs<span class="token punctuation">,</span> emit<span class="token punctuation">,</span> root <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">;</span>
    <span class="token keyword">const</span> rulesConfig <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> rules<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">doRegister</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> formParamsType</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">handleRegisterProxy</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token string">'regiter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleProtal</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">path</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      root<span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> account<span class="token punctuation">,</span> password<span class="token punctuation">,</span> authCode<span class="token punctuation">,</span> useServer <span class="token punctuation">}</span> <span class="token operator">=</span> formParams<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token punctuation">(</span>refs<span class="token punctuation">.</span>form <span class="token keyword">as</span> InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Form<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">valid</span><span class="token operator">:</span> Boolean</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> formParamsType <span class="token operator">=</span> <span class="token punctuation">{</span>
            account<span class="token punctuation">,</span>
            <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token function">md5</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span>
            authCode<span class="token punctuation">,</span>
            useServer<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token function">doRegister</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送验证码</span>
    <span class="token keyword">const</span> <span class="token function-variable function">sendCode</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> account <span class="token punctuation">}</span> <span class="token operator">=</span> formParams<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        phoneNum<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> number<span class="token punctuation">;</span>
        email<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
        <span class="token literal-property property">authCodeType</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">authCodeType</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 0 注册 1验证码登陆 2 找回密码</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">PHONE_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span>phoneNum <span class="token operator">=</span> account<span class="token punctuation">;</span>
        <span class="token comment">//    params.countryCode = '+86';</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">EMAIL_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">.</span>email <span class="token operator">=</span> account<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">handlegetRegistVCodeProxy</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span>$Message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">content</span><span class="token operator">:</span> root<span class="token punctuation">.</span><span class="token function">$t</span><span class="token punctuation">(</span><span class="token string">'common.message.success'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span> <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleLogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      root<span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      formParams<span class="token punctuation">,</span>
      rulesConfig<span class="token punctuation">,</span>
      handleSubmit<span class="token punctuation">,</span>
      handleProtal<span class="token punctuation">,</span>
      sendCode<span class="token punctuation">,</span>
      handleLogin<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>不知道你注意一段代码没有，以前的表单校验<code v-pre>rule</code>与<code v-pre>formParams</code>全部从<code v-pre>useRegister</code>解构了出来，在<code v-pre>vue3</code>大量的<code v-pre>api</code>都是用<code v-pre>hooks</code>的思想写的，与<code v-pre>react</code>越来越相似，在<code v-pre>react</code>中，函数式组件，<code v-pre>hooks</code>极大的解耦了业务组件，React 构建的页面思想就是像搭积木一样，每个视图模块就是一个组件，在<code v-pre>vue2</code>之前虽然提供了<code v-pre>render</code>渲染组件，但是对于像<code v-pre>react</code>一样天然支持<code v-pre>jsx</code>的能力还是非常欠缺,虽然在<code v-pre>vue</code>也可以申明函数组件，也提供的<code v-pre>template</code>模板的方式。但是<code v-pre>composition-api</code>除了支持<code v-pre>jsx</code>，有更大的<code v-pre>ts</code>能力，让你组织你的代码，更强壮，可维护性更强，业务逻辑能进一步复用并减少耦合。</p>
<p>接下来我们来看下<code v-pre>useRegister</code>这个引入的<code v-pre>hook</code>,我们通常把这个方法有个更优雅的名字来定义它<code v-pre>useXXXX</code>,也就是类比 react 中的<code v-pre>hook</code></p>
<div class="language-javascript ext-js line-numbers-mode"><pre v-pre class="language-javascript"><code><span class="token comment">// hooks/index.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/composition-api'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> i18n <span class="token keyword">from</span> <span class="token string">'@/i18n/index'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> commonRegexp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/index'</span><span class="token punctuation">;</span>

<span class="token comment">// step进度条</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useStepConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> setUpConfig <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">currentStep</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">steps</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.steps.one'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.steps.two'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.steps.three'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>setUpConfig<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 账号注册</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useRegister</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> registeConfig <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">formParams</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">account</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rpassword</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">authCode</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token literal-property property">agreeAndComply</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">useServer</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">useServer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'change'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_rule</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.useServer.message'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">account</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
          <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_rule</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.account.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
              <span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">MOBILE_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
              <span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">EMAIL_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.account.message'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_rule</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.password.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>commonRegexp<span class="token punctuation">.</span><span class="token constant">PASSWORD_REG_EXP</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.password.regCheckMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">rpassword</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_rule</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.rpassword.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> registeConfig<span class="token punctuation">.</span>formParams<span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.rpassword.notMatchMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">authCode</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">_rule</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>i18n<span class="token punctuation">.</span><span class="token function">t</span><span class="token punctuation">(</span><span class="token string">'register.registerForm.authCode.emptyMessage'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">trigger</span><span class="token operator">:</span> <span class="token string">'blur'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>registeConfig<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 信息填写</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">userRegistInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
   <span class="token operator">...</span>
   <span class="token keyword">return</span> <span class="token punctuation">{</span>

   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个<code v-pre>hook</code>文件已经把三个步奏用到的数据层已经高度的分离了出去，在实际业务中，你并不一定需要写在一个文件中,如果涉及多人合作，那么你可以把<code v-pre>index</code>里面拆分得更细些，比如这里你差分成三个不同<code v-pre>ts</code>文件<code v-pre>userRegistInfo.ts</code>、<code v-pre>useRegister.ts</code>、<code v-pre>useStepConfig.ts</code>，我们把每一块自己需要数据写入自己相关的<code v-pre>hooks</code>中，这样每个人只需要维护自己那份代码就行。</p>
<p>看到这里你是否感受到<code v-pre>composition-api</code>的思想呢，在<code v-pre>vue3</code>中，所有的<code v-pre>api</code>用法几乎与<code v-pre>composition-api</code>用法一样，在官方有这么一段话,<code v-pre>当迁移到 Vue 3 时，只需简单的将 @vue/composition-api 替换成 vue 即可。你现有的代码几乎无需进行额外的改动。</code>。看到这里，你情不自禁的发出尖叫，<code v-pre>vue3</code>向下兼容了<code v-pre>vue2</code>,并且当你用<code v-pre>composition-api</code>过渡<code v-pre>vue3</code>时，我只需要全局替换一下<code v-pre>@vue/composition-api</code>这个就可以全量升级到<code v-pre>vue3</code>了。</p>
<p>此时你心中有没有被震惊到，赶紧升级你项目的<code v-pre>vue2</code>,让你自己在<code v-pre>vue2</code>的项目中也能畅游<code v-pre>vue3</code>的各种姿势，哈哈。
<img src="https://img.soogif.com/8CMCL0jH4GcLNpUTiyKs5HqxDhRm4JHv.gif?scope=mdnice" alt=""></p>
<h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3>
<p>1.在 vue2 中使用<code v-pre>options</code>面条方式编码，业务页面有冗余代码，当我们发现字段设计与交互有差别时，可以与产品设计沟通，用你的理由说服他</p>
<p>2.在 vue2 中用<code v-pre>composition-api</code>方式组织你的业务代码时，明显感受到业务逻辑比以前更清晰，并且天然支持<code v-pre>ts</code>,让你的代码更安全，更强壮 💪</p>
<p>3.类似 react 的<code v-pre>hook</code>思想，高度解耦业务视图层的数据逻辑，让你更专注解决疑难杂症，或者有更多的时间轻松聊天喝茶摸鱼。</p>
<p>4.更多关于<a href="https://github.com/vuejs/composition-api/blob/main/README.zh-CN.md" title="composition-api" target="_blank" rel="noopener noreferrer">composition-api<ExternalLinkIcon/></a>,更多 vue3 参考<a href="https://v3.cn.vuejs.org/guide/composition-api-introduction.html" title="官网" target="_blank" rel="noopener noreferrer">官网<ExternalLinkIcon/></a></p>
</div></template>
