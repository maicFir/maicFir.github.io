---
title: ç»„åˆå¼APIæœ€ä½³å®è·µ
date: 2022-01-15
sidebarDepth: 3
---

`vueç»„åˆå¼`æ˜¯`vue2`é¡¹ç›®è¿‡æ¸¡`vue3`çš„ä¸€ç§å‹å¥½æ–¹æ¡ˆï¼Œåœ¨å†å²é¡¹ç›®é€æ­¥è¿ç§»åˆ°`vue3`ä¸­ï¼Œæœ‰é¡¹ç›®å†å²åŒ…è¢±åŸå› ï¼Œä¸€ä¸‹å­å‡çº§å¸¦æ¥çš„é—®é¢˜å¯èƒ½æ¯”è¾ƒå¤šï¼Œ`composition-api`å¤©ç„¶å…¼å®¹`vue2`,åœ¨`vue2`ä¸­ä½¿ç”¨`ç»„åˆå¼API`è®©ä½ æå‰æ„Ÿå—`vue3`çš„å„ç§å§¿åŠ¿ï¼Œ`vue3`å·²ç»å‡ºæ¥ 3 å¹´äº†ï¼Œéƒ½`2022`äº†ï¼Œ`vue`ç¥–å¸ˆçˆ·èµé¥­åƒï¼Œç›¸ä¿¡ä½ è·Ÿç¬”è€…ä¸€æ ·æ—©å·²è·ƒè·ƒæ¬²è¯•ã€‚

![](https://img.soogif.com/IeWk1WWjT3XDOMWtSB7kgeoWbvaBIBGe.gif?scope=mdnice)

å‰æ®µæ—¶é—´ï¼Œç¬”è€…é¡¹ç›®å·²ç»å®Œæˆå‡çº§`ts`ã€`ç»„åˆå¼api`,æ¯•ç«Ÿå»å¹´ç¬¬ 4 å­£åº¦é¦–è¦`KPI`ä¾¿æ˜¯å‡çº§é¡¹ç›®ä¸šåŠ¡å¼•å…¥`ts`å’Œ`ç»„åˆå¼API`ã€‚åœ¨ä¸€è¾¹æ¬ç –è¿­ä»£ä¸šåŠ¡ï¼Œä¸€è¾¹å‡çº§é¡¹ç›®æŠ€æœ¯æ ˆçš„æŒ‘æˆ˜ï¼Œè¿‡ç¨‹è™½æ›²æŠ˜ï¼Œå¥½åœ¨ç»„å†…æœ‰å¤§ä½¬åŠæ—¶è§£å›´ï¼Œå¸¸å¸¸é‡åˆ°å¥‡è‘©é—®é¢˜ï¼Œç®—æ˜¯å°‘èµ°å¼¯è·¯ã€‚æœ¬ç¯‡ä¸åš`ç»„åˆå¼APIè¯­æ³•`è¿‡æ¸¡è§£è¯»ï¼Œå› æœ€è¿‘ä¸€ä¸ªé¡µé¢éœ€æ±‚ä¼˜åŒ–ï¼Œä»¥æœ€ç®€å•çš„æ³¨å†Œä¸šåŠ¡ä¸ºä¾‹ï¼Œåœ¨`vue2`ä¸`ç»„åˆå¼API`çš„é€‰æ‹©ä¸­ï¼Œå¸Œæœ›ç»™ä½ çš„é¡¹ç›®å‡çº§çš„è¿‡ç¨‹ä¸­å¸¦æ¥ä¸€ç‚¹ç‚¹å¸®åŠ©å’Œæ€è€ƒã€‚

æ­£æ–‡å¼€å§‹...

### æ³¨å†Œé¡µé¢

è¿™æ˜¯ä¸€ä¸ªéå¸¸æ™®é€šçš„ä¸€ä¸ªæ³¨å†Œæµç¨‹ï¼Œå¯ä»¥çœ‹ä¸‹å…·ä½“é¡µé¢ï¼Œ`ç¬¬ä¸€æ­¥è´¦å·æ³¨å†Œ`
![](https://files.mdnice.com/user/24614/3c066083-baab-416d-8e67-7b14fed9e268.jpg)

### ä¿¡æ¯ç™»è®°

è¿™æ˜¯å®Œæˆæ³¨å†Œåï¼Œéœ€è¦ç™»è®°ä¿¡æ¯`ç¬¬äºŒæ­¥ä¿¡æ¯ç™»è®°`
![](https://files.mdnice.com/user/24614/bf23769f-8dba-4504-a58e-13f30b82ced3.jpg)

### ç­‰å¾…å®¡æ ¸

åœ¨ç¬¬äºŒæ­¥å®Œæˆä¿¡æ¯ç™»è®°æˆåŠŸåï¼Œä¾¿ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ä¾¿å¯æˆåŠŸç™»é™†æ§åˆ¶å°
![](https://files.mdnice.com/user/24614/572d56c3-78af-420d-af0c-0dbcdf2a536a.jpg)

### çœ‹ä¸‹æœªå‡çº§ä¹‹å‰çš„ä»£ç ï¼ˆvue2ï¼‰ç‰ˆæœ¬

```javascript
// Index.vue
<template>
  <a-base-page-layout>
    <i-card class="page-content-card">
      <i-steps :current="currentStep">
        <i-step v-for="step of steps" :key="step.value" :title="$t(step.label)"></i-step>
      </i-steps>
      <i-divider></i-divider>
      <!--æ³¨å†Œ-->
      <a-register v-if="currentStep === 0" class="step-one" @finish="finishRegister"></a-register>
      <!--ä¿¡æ¯ç™»è®°-->
      <a-info v-if="currentStep === 1" class="step-two" @finish="finishRegisterInfo"></a-info>
      <!--ç­‰å¾…å®¡æ ¸-->
      <a-moderation v-if="currentStep === 2" class="step-three"></a-moderation>
    </i-card>
  </a-base-page-layout>
</template>
```

```javascript
// Index.vue
<script>
import auth from '@/service/auth';
import { BasePageLayout } from '@/components';
import Register from './Register';
import Info from './Info';
import Moderation from './Moderation';

export default {
  components: {
    ABasePageLayout: BasePageLayout,
    ARegister: Register,
    AInfo: Info,
    AModeration: Moderation,
  },
  data() {
    return {
      currentStep: 0,
      steps: [
        {
          value: 1,
          label: 'register.steps.one',
        },
        {
          value: 2,
          label: 'register.steps.two',
        },
        {
          value: 3,
          label: 'register.steps.three',
        },
      ],
    };
  },
  methods: {
    finishRegister(result) {
      if (result.developerInfo) {
        if (result.developerInfo.enabled) {
          this.$Message.info(this.$t('register.message.registerd'));
          auth.goLogin('/');
        } else {
          this.currentStep = 2;
        }
      } else {
        this.currentStep = 1;
      }
    },
    finishRegisterInfo() {
      this.currentStep = 2;
    },
  },
  created() {
    const step = +this.$route.query.step;
    if (step) {
      this.currentStep = step;
    } else {
      this.currentStep = 0;
    }
  },
};
</script>
```

ä»¥ä¸Šæ˜¯`index.vue`,æ¨¡æ¿å’Œé€»è¾‘æ˜¯å¸¸ç”¨çš„`options`å’Œ`template`æ–¹å¼ï¼Œåœ¨`vue2`ä¸­çœ‹èµ·æ¥ä¼¼ä¹æ²¡æ¯›ç—…ã€‚

æˆ‘ä»¬åœ¨ç»§ç»­å…³æ³¨ç¬¬ä¸€æ­¥`Register.vue`ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

`æ¨¡æ¿ä»£ç `

```javascript
// Register.vue
<template>
  <div>
    <i-alert class="warm-prompt-alert" show-icon closable>
      <span class="warm-prompt-tips">{{ $t('register.warmPrompt.title') }}</span>
      <span slot="desc">{{ $t('register.warmPrompt.content') }}</span>
    </i-alert>
    <i-row>
      <i-col span="12" offset="6">
        <i-tabs>
          <!-- æ‰‹æœºå·æ³¨å†Œ -->
          <i-tab-pane :label="$t('register.tabs.phone')" icon="ios-phone-portrait">
            <i-form
              :model="registerPhoneForm"
              ref="registerPhoneForm"
              :rules="phoneRuleValidate"
              :label-width="140"
            >
              <a-fixed-autofill-password></a-fixed-autofill-password>
              <i-form-item :label="$t('register.registerForm.phone.label')" prop="phone">
                <i-input
                  v-model="registerPhoneForm.phone"
                  :placeholder="$t('register.registerForm.phone.placeholder')"
                ></i-input>
              </i-form-item>
              <i-form-item :label="$t('register.registerForm.password.label')" prop="password">
                <i-input
                  type="password"
                  v-model="registerPhoneForm.password"
                  :placeholder="$t('register.registerForm.password.placeholder')"
                ></i-input>
              </i-form-item>
              <i-form-item :label="$t('register.registerForm.rpassword.label')" prop="rpassword">
                <i-input
                  type="password"
                  v-model="registerPhoneForm.rpassword"
                  :placeholder="$t('register.registerForm.rpassword.placeholder')"
                ></i-input>
              </i-form-item>
              <i-form-item :label="$t('register.registerForm.authCode.label')" prop="authCode">
                <i-row type="flex" class="authcode-row">
                  <i-col>
                    <i-input
                      v-model="registerPhoneForm.authCode"
                      :placeholder="$t('register.registerForm.authCode.placeholder')"
                    ></i-input>
                  </i-col>
                  <i-col class="padding-left-16">
                    <a-vcode-button
                      @send-code="sendCode('phone')"
                      :disabled="!registerPhoneForm.phone"
                    ></a-vcode-button>
                  </i-col>
                </i-row>
              </i-form-item>
              <i-form-item>
                <i-checkbox v-model="registerPhoneForm.agreeAndComply">
                  {{ $t('login.agreeAndComply') }}
                  <a @click="handleProtal('/user-agreement')" class="link">
                    {{ $t('login.userAgreement') }}
                  </a>
                  ä¸
                  <a @click="handleProtal('/privacy-policy')" class="link">
                    {{ $t('login.privacyPolicy') }}
                  </a>
                </i-checkbox>
              </i-form-item>
              <i-form-item>
                <i-button
                  type="primary"
                  @click="submitPhoneForm"
                  :disabled="!registerPhoneForm.agreeAndComply"
                >
                  {{ $t('register.registerForm.submitButtonLabel') }}
                </i-button>
              </i-form-item>
            </i-form>
          </i-tab-pane>
          <!-- é‚®ç®±æ³¨å†Œ -->
          <i-tab-pane :label="$t('register.tabs.email')" icon="ios-mail">
            <i-form
              :model="registerEmailForm"
              ref="registerEmailForm"
              :rules="emailRuleValidate"
              :label-width="140"
            >
              <a-fixed-autofill-password></a-fixed-autofill-password>
              <i-form-item :label="$t('register.registerForm.email.label')" prop="email">
                <i-input
                  v-model="registerEmailForm.email"
                  :placeholder="$t('register.registerForm.email.placeholder')"
                ></i-input>
              </i-form-item>
              <i-form-item :label="$t('register.registerForm.password.label')" prop="password">
                <i-input
                  type="password"
                  v-model="registerEmailForm.password"
                  :placeholder="$t('register.registerForm.password.placeholder')"
                ></i-input>
              </i-form-item>
              <i-form-item :label="$t('register.registerForm.rpassword.label')" prop="rpassword">
                <i-input
                  type="password"
                  v-model="registerEmailForm.rpassword"
                  :placeholder="$t('register.registerForm.rpassword.placeholder')"
                ></i-input>
              </i-form-item>
              <i-form-item :label="$t('register.registerForm.authCode.label')" prop="authCode">
                <i-row type="flex" class="authcode-row">
                  <i-col>
                    <i-input
                      v-model="registerEmailForm.authCode"
                      :placeholder="$t('register.registerForm.authCode.placeholder')"
                    ></i-input>
                  </i-col>
                  <i-col class="padding-left-16">
                    <a-vcode-button
                      @send-code="sendCode('email')"
                      :disabled="!registerEmailForm.email"
                    ></a-vcode-button>
                  </i-col>
                </i-row>
              </i-form-item>
              <i-form-item>
                <i-checkbox v-model="registerEmailForm.agreeAndComply">
                  {{ $t('login.agreeAndComply') }}
                  <a @click="handleProtal('/user-agreement')" class="link">
                    {{ $t('login.userAgreement') }}
                  </a>
                  ä¸
                  <a @click="handleProtal('/privacy-policy')" class="link">
                    {{ $t('login.privacyPolicy') }}
                  </a>
                </i-checkbox>
              </i-form-item>
              <i-form-item>
                <i-button
                  type="primary"
                  @click="submitEmailForm"
                  :disabled="!registerEmailForm.agreeAndComply"
                >
                  {{ $t('register.registerForm.submitButtonLabel') }}
                </i-button>
              </i-form-item>
            </i-form>
          </i-tab-pane>
        </i-tabs>
      </i-col>
    </i-row>
  </div>
</template>
```

`jsä»£ç `

```javascript
// Register.vue
<script>
import md5 from 'blueimp-md5';
import { commonRegexp } from '@/utils/index';
import { VcodeButton, FixedAutofillPassword } from '@/components';
import { handlegetRegistVCodeProxy, handleRegisterProxy } from '@/service/proxy/index';

export default {
  components: {
    AVcodeButton: VcodeButton,
    AFixedAutofillPassword: FixedAutofillPassword,
  },
  data() {
    return {
      registerPhoneForm: {
        phone: '',
        password: '',
        rpassword: '',
        authCode: '',
        agreeAndComply: true,
      },
      phoneRuleValidate: {
        phone: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.phone.emptyMessage')));
              } else if (!commonRegexp.MOBILE_REG_EXP.test(value)) {
                callback(new Error(this.$t('register.registerForm.phone.regCheckMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
        password: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.password.emptyMessage')));
              } else if (!commonRegexp.PASSWORD_REG_EXP.test(value)) {
                callback(new Error(this.$t('register.registerForm.password.regCheckMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
        rpassword: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.rpassword.emptyMessage')));
              } else if (value !== this.registerPhoneForm.password) {
                callback(new Error(this.$t('register.registerForm.rpassword.notMatchMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
        authCode: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.authCode.emptyMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
      },
      registerEmailForm: {
        email: '',
        password: '',
        rpassword: '',
        authCode: '',
        agreeAndComply: true,
      },
      emailRuleValidate: {
        email: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.email.emptyMessage')));
              } else if (!commonRegexp.EMAIL_REG_EXP.test(value)) {
                callback(new Error(this.$t('register.registerForm.email.regCheckMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
        password: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.password.emptyMessage')));
              } else if (!commonRegexp.PASSWORD_REG_EXP.test(value)) {
                callback(new Error(this.$t('register.registerForm.password.regCheckMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
        rpassword: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.rpassword.emptyMessage')));
              } else if (value !== this.registerEmailForm.password) {
                callback(new Error(this.$t('register.registerForm.rpassword.notMatchMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
        authCode: [
          {
            required: true,
            validator: (rule, value, callback) => {
              if (value === '') {
                callback(new Error(this.$t('register.registerForm.authCode.emptyMessage')));
              } else {
                callback();
              }
            },
            trigger: 'blur',
          },
        ],
      },
    };
  },
  methods: {
    handleProtal(path) {
      this.$router.push(path);
    },
    async sendCode(type) {
      const params = {};
      if (type === 'phone') {
        params.phoneNum = this.registerPhoneForm.phone;
        params.countryCode = '+86';
      } else if (type === 'email') {
        params.email = this.registerEmailForm.email;
      }
      params.authCodeType = 0; // 0 æ³¨å†Œ 1éªŒè¯ç ç™»é™† 2 æ‰¾å›å¯†ç 
      try {
        await handlegetRegistVCodeProxy(params);
        this.$Message.success({
          content: this.$t('common.message.success'),
        });
      } catch (err) {
        throw err;
      }
    },
    async _doRegister(params) {
      const res = await handleRegisterProxy(params);
      console.log(res, 'register');
      this.$emit('finish', res);
    },
    submitPhoneForm() {
      const {
        registerPhoneForm: { phone: account, password, authCode },
      } = this;
      this.$refs.registerPhoneForm.validate(valid => {
        if (valid) {
          const params = {
            account,
            password: md5(password),
            authCode,
          };
          this._doRegister(params);
        }
      });
    },
    submitEmailForm() {
      const {
        registerEmailForm: { email: account, password, authCode },
      } = this;
      this.$refs.registerEmailForm.validate(valid => {
        if (valid) {
          const params = {
            account,
            password: md5(password),
            authCode,
          };
          this._doRegister(params);
        }
      });
    },
  },
};
</script>
```

è¿™ä¸ªé¡µé¢ä»£ç å¦‚æ­¤å†—ä½™ï¼Œæˆ‘ä»¬å‘ç°æœ‰éå¸¸å¤šé‡å¤çš„ä¸œè¥¿ï¼Œç”¨äº†ä¸¤ä¸ª`tab`åˆ‡æ¢ä¸¤ç§ä¸åŒæ–¹å¼æ³¨å†Œï¼Œä½†å®é™…ä¸Šå‘ç°`æ‰‹æœºæ³¨å†Œ`ã€`é‚®ç®±`æ³¨å†Œæœ€åè°ƒç”¨æ¥å£éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å†—ä½™ä»£ç æœ‰äº›å¤šï¼Œä»£ç è™½é•¿äº†äº›ï¼Œå¥½åœ¨èƒ½æ”¹å¾—åŠ¨ã€‚

### å‡çº§åä»£ç ï¼ˆç»„åˆå¼ APIï¼‰

ç”¨`jsx`ä¸`composition-api`é‡æ„äº†è¿™ä¸ªé¡µé¢ï¼Œå‡å°‘äº†å¾ˆå¤šä¸å¿…è¦çš„ä»£ç 

æ–°é‡æ„`Index.vueæ¨¡æ¿ä»£ç `

```javascript
// Index.vue
<script lang="tsx">
import { defineComponent, SetupContext, watch, onMounted } from '@vue/composition-api';
import Qs from 'qs';
import auth from '@/service/auth';

import { BasePageLayout } from '@/components';
import { useStepConfig } from './hooks';
import Register from './Register.vue';
import Info from './Info.vue';
import Moderation from './Moderation.vue';
import AuditFail from './AuditFail.vue';

export default defineComponent({
  components: {
    ABasePageLayout: BasePageLayout,
    ARegister: Register,
    AInfo: Info,
    AModeration: Moderation,
    AuditFail,
  },
  setup(props, ctx: SetupContext) {
    const { currentStep, steps } = useStepConfig();
    const { root } = ctx;
    // å®Œæˆæ³¨å†Œ
    const finish = (result: PlainObj, setType: string) => {
      if (setType === 'regiter') {
        if (result.developerInfo) {
          if (result.developerInfo.enabled) {
            root.$Message.info(root.$t('register.message.registerd'));
            auth.goLogin('/');
          } else {
            root.$router.replace('/register?step=2');
          }
        } else {
          root.$router.replace('/register?step=1');
        }
      } else {
        // const { step, status } = result;
        const params = Qs.stringify(result, { addQueryPrefix: true });
        root.$router.push(`/register${params}`);
      }
    };

    watch(
      () => root.$route,
      (val): void => {
        const {
          query: { step = 0 },
        } = val;
        currentStep.value = step ? Number(step) : 0;
      }
    );
    onMounted(() => {
      const step = +root.$route.query.step;
      currentStep.value = step || 0;
    });
    return {
      currentStep,
      steps,
      finish,
    };
  },
  render() {
    const { currentStep, steps, finish } = this;
    const CurentComponent: any = (): JSX.Element => {
      const ret: {
        [key: number]: JSX.Element;
      } = {
        0: <a-register class="step-one" onFinish={finish}></a-register>,
        1: <a-info class="step-two" onFinish={finish}></a-info>,
        2: <a-moderation class="step-three"></a-moderation>,
      };
      return ret[currentStep];
    };
    return (
      <div class="register">
        <a-base-page-layout>
          <a-card class="page-content-card">
            {currentStep === 3 ? (
              <audit-fail onFinish={finish}></audit-fail>
            ) : (
              <div>
                <i-steps current={currentStep}>
                  {steps.map(v => (
                    <i-step key={v.value} title={v.label.value}></i-step>
                  ))}
                </i-steps>
                {[1, 2].includes(currentStep) ? (
                  <i-divider style="width:auto;min-width:80%;margin:30px 60px;"></i-divider>
                ) : null}
                <CurentComponent />
              </div>
            )}
          </a-card>
        </a-base-page-layout>
      </div>
    );
  },
});
</script>
```

ç”±é¡µé¢ç»“æ„æ¥çœ‹ï¼Œå…¶å®ä¸æœªå‡çº§å‰å¹¶æ²¡æœ‰å‘ç”Ÿå¤šå¤§å˜åŒ–ï¼Œå°±æ˜¯ç¬¬ä¸€æ­¥æ³¨å†Œæ“ä½œã€ç¬¬äºŒæ­¥ä¿¡æ¯ç™»è®°ï¼Œç¬¬ä¸‰éƒ¨ç­‰å¾…å®¡æ ¸ã€‚ä¸è¿‡æ³¨æ„é¡µé¢ä¸Šè¿˜æœ‰ä¸€ä¸ªçŠ¶æ€`currentStep=3`çš„æ¡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªç­‰å¾…å®¡æ ¸è¢«æ‹’ç»çš„é¡µé¢çŠ¶æ€ã€‚é¡µé¢æ¯ä¸ªæ­¥éª¤çš„é˜¶æ®µæ˜¾ç¤ºéƒ½æ˜¯é€šè¿‡è·¯ç”±çš„`currentStep`æ¥åšåˆ¤æ–­æ ‡è¯†ã€‚

é‡æ„ååæ–°æ³¨å†Œé¡µé¢`æ¨¡æ¿ä»£ç `

```javascript
// Register.vue
<template>
  <div>
    <i-alert class="warm-prompt-alert">
      <span slot="desc">
        {{ $t('register.warmPrompt.title') }}{{ $t('register.warmPrompt.content') }}
        <a href="javascript:void(0)" style="color: #4754ff" @click="handleLogin">
          {{ $t('register.warmPrompt.accountLogin') }}
        </a>
      </span>
    </i-alert>
    <i-row>
      <i-col span="12" offset="6">
        <i-form :model="formParams" :rules="rulesConfig" ref="form" :label-width="140">
          <a-fixed-autofill-password></a-fixed-autofill-password>
          <i-form-item :label="$t('register.registerForm.useServer.label')" prop="useServer">
            <i-select
              style="width: 320px"
              v-model="formParams.useServer"
              :placeholder="$t('register.registerForm.useServer.placeholder')"
            >
              <i-option
                v-for="item in useServerListOption"
                :value="item.value"
                :key="item.value"
                :label="$t(item.label)"
              ></i-option>
            </i-select>
          </i-form-item>
          <i-form-item :label="$t('register.registerForm.account.label')" prop="account">
            <i-input
              v-model.trim="formParams.account"
              clearable
              :placeholder="$t('register.registerForm.account.placeholder')"
            ></i-input>
          </i-form-item>
          <i-form-item :label="$t('register.registerForm.password.label')" prop="password">
            <i-input
              type="password"
              clearable
              v-model.trim="formParams.password"
              :placeholder="$t('register.registerForm.password.placeholder')"
            ></i-input>
          </i-form-item>
          <i-form-item :label="$t('register.registerForm.rpassword.label')" prop="rpassword">
            <i-input
              type="password"
              clearable
              v-model="formParams.rpassword"
              :placeholder="$t('register.registerForm.rpassword.placeholder')"
            ></i-input>
          </i-form-item>
          <i-form-item :label="$t('register.registerForm.authCode.label')" prop="authCode">
            <i-row type="flex" class="authcode-row">
              <i-col>
                <i-input
                  v-model="formParams.authCode"
                  clearable
                  :placeholder="$t('register.registerForm.authCode.placeholder')"
                ></i-input>
              </i-col>
              <i-col class="padding-left-16">
                <a-vcode-button
                  :sendCode="sendCode"
                  :disabled="!formParams.account"
                ></a-vcode-button>
              </i-col>
            </i-row>
          </i-form-item>
          <i-form-item>
            <i-checkbox v-model="formParams.agreeAndComply">
              {{ $t('login.agreeAndComply') }}
              <a @click="handleProtal('/user-agreement')" class="link">
                {{ $t('login.userAgreement') }}
              </a>
              ä¸
              <a @click="handleProtal('/privacy-policy')" class="link">
                {{ $t('login.privacyPolicy') }}
              </a>
            </i-checkbox>
          </i-form-item>
          <i-form-item>
            <i-button
              style="width: 100%"
              type="primary"
              @click="handleSubmit"
              :disabled="!formParams.agreeAndComply"
            >
              {{ $t('register.registerForm.submitButtonLabel') }}
            </i-button>
          </i-form-item>
        </i-form>
      </i-col>
    </i-row>
  </div>
</template>
```

æˆ‘ä»¬å‘ç°æ¨¡æ¿é¡µé¢å°‘äº†é‚®ç®±ä¸æ‰‹æœºå·çš„åŒºåˆ«ï¼Œè¿™æ˜¯å› ä¸ºæŠŠæ‰‹æœºå·ä¸é‚®ç®±ç»Ÿç§°ä¸ºè´¦å·äº†ï¼Œç¬”è€…è®¤ä¸ºåœ¨éœ€æ±‚é˜¶æ®µåº”è¯¥å°±èƒ½è€ƒè™‘åˆ°ï¼Œç”±äºæ¥å£è®¾è®¡åŸå› ï¼Œé‚®ç®±å’Œæ‰‹æœºå·ä¸ºä¸€ä¸ªå­—æ®µï¼Œä½†æ˜¯å‰ç«¯è¡¨ç°å½¢å¼ä¸ä¸€æ ·ï¼Œè­¬å¦‚æ¶‰åŠé‚®ç®±å’Œæ‰‹æœºå·çš„æ­£åˆ™æ ¡éªŒï¼Œå› æ­¤ï¼Œåœ¨éœ€æ±‚ä¸ç¼–ç é˜¶æ®µï¼Œä½ æ˜¯å¦ä¼šèµ°ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Ÿè¿˜æ˜¯è¯´ä»¥åç«¯ä¸€ä¸ªå­—æ®µè®¾è®¡ä¸ºå‡†ï¼Œåœ¨è§†å›¾å±‚é‡Œï¼Œä½ ä¸è¦é‚£ä¹ˆæ˜ç¡®çš„ç»™ç”¨æˆ·ä¸¤ç§æ–¹å¼é€‰æ‹©ã€‚æœ‰æ›´å¥½çš„é€‰æ‹©ï¼Œå¦‚æœè®¾è®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¸äº§å“è®¾è®¡æ²Ÿé€šï¼Œå› ä¸ºåªè¦ä½ æœ‰ç†ç”±è¯´æœäº†ä»–ä»¬ï¼Œé‚£ä¹ˆå°±ä¼šå¢åŠ ä»£ç çš„å¯å¤ç”¨åº¦ï¼Œé™ä½å†—ä½™ä»£ç çš„å †ç§¯ï¼Œä»è€Œå‡å°‘ç»´æŠ¤æˆæœ¬ã€‚

é‡æ„åæ–°æ³¨å†Œ`jsä»£ç `

```javascript
// Register.vue
<script lang="tsx">
import { defineComponent, SetupContext, computed } from '@vue/composition-api';
import { Form } from 'view-design';
import md5 from 'blueimp-md5';
import { commonRegexp } from '@/utils/index';
import { VcodeButton, FixedAutofillPassword } from '@/components';
import useServerListOptionMinx from '@/mixins/useServerListOptionMinx';
import { handlegetRegistVCodeProxy, handleRegisterProxy } from '@/service/proxy/index';
import { useRegister } from './hooks';
interface formParamsType {
  account: string;
  password: string;
  authCode: string | number;
  useServer: number | string;
}
export default defineComponent({
  components: {
    AVcodeButton: VcodeButton,
    AFixedAutofillPassword: FixedAutofillPassword,
  },
  mixins: [useServerListOptionMinx],
  setup(props: any, ctx: SetupContext) {
    const { formParams, rules } = useRegister();
    const { refs, emit, root } = ctx;
    const rulesConfig = computed(() => rules.value);
    const doRegister = async (params: formParamsType) => {
      const res = await handleRegisterProxy(params);
      emit('finish', res, 'regiter');
    };
    const handleProtal = (path: string) => {
      root.$router.push(path);
    };
    const handleSubmit = () => {
      const { account, password, authCode, useServer } = formParams.value;
      (refs.form as InstanceType<typeof Form>).validate((valid: Boolean) => {
        if (valid) {
          const params: formParamsType = {
            account,
            password: md5(password),
            authCode,
            useServer,
          };
          doRegister(params);
        }
      });
    };
    // å‘é€éªŒè¯ç 
    const sendCode = async (callback: Function) => {
      const { account } = formParams.value;
      const params: {
        phoneNum?: string | number;
        email?: string;
        authCodeType: number;
      } = {
        authCodeType: 0, // 0 æ³¨å†Œ 1éªŒè¯ç ç™»é™† 2 æ‰¾å›å¯†ç 
      };
      if (commonRegexp.PHONE_REG_EXP.test(account)) {
        params.phoneNum = account;
        //    params.countryCode = '+86';
      } else if (commonRegexp.EMAIL_REG_EXP.test(account)) {
        params.email = account;
      }
      try {
        await handlegetRegistVCodeProxy(params);
        root.$Message.success({
          content: root.$t('common.message.success'),
        } as any);
        callback(true);
      } catch (err) {
        callback(false);
        throw err;
      }
    };
    const handleLogin = () => {
      root.$router.push('/login');
    };
    return {
      formParams,
      rulesConfig,
      handleSubmit,
      handleProtal,
      sendCode,
      handleLogin,
    };
  },
});
</script>
```

ä¸çŸ¥é“ä½ æ³¨æ„ä¸€æ®µä»£ç æ²¡æœ‰ï¼Œä»¥å‰çš„è¡¨å•æ ¡éªŒ`rule`ä¸`formParams`å…¨éƒ¨ä»`useRegister`è§£æ„äº†å‡ºæ¥ï¼Œåœ¨`vue3`å¤§é‡çš„`api`éƒ½æ˜¯ç”¨`hooks`çš„æ€æƒ³å†™çš„ï¼Œä¸`react`è¶Šæ¥è¶Šç›¸ä¼¼ï¼Œåœ¨`react`ä¸­ï¼Œå‡½æ•°å¼ç»„ä»¶ï¼Œ`hooks`æå¤§çš„è§£è€¦äº†ä¸šåŠ¡ç»„ä»¶ï¼ŒReact æ„å»ºçš„é¡µé¢æ€æƒ³å°±æ˜¯åƒæ­ç§¯æœ¨ä¸€æ ·ï¼Œæ¯ä¸ªè§†å›¾æ¨¡å—å°±æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œåœ¨`vue2`ä¹‹å‰è™½ç„¶æä¾›äº†`render`æ¸²æŸ“ç»„ä»¶ï¼Œä½†æ˜¯å¯¹äºåƒ`react`ä¸€æ ·å¤©ç„¶æ”¯æŒ`jsx`çš„èƒ½åŠ›è¿˜æ˜¯éå¸¸æ¬ ç¼º,è™½ç„¶åœ¨`vue`ä¹Ÿå¯ä»¥ç”³æ˜å‡½æ•°ç»„ä»¶ï¼Œä¹Ÿæä¾›çš„`template`æ¨¡æ¿çš„æ–¹å¼ã€‚ä½†æ˜¯`composition-api`é™¤äº†æ”¯æŒ`jsx`ï¼Œæœ‰æ›´å¤§çš„`ts`èƒ½åŠ›ï¼Œè®©ä½ ç»„ç»‡ä½ çš„ä»£ç ï¼Œæ›´å¼ºå£®ï¼Œå¯ç»´æŠ¤æ€§æ›´å¼ºï¼Œä¸šåŠ¡é€»è¾‘èƒ½è¿›ä¸€æ­¥å¤ç”¨å¹¶å‡å°‘è€¦åˆã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹`useRegister`è¿™ä¸ªå¼•å…¥çš„`hook`,æˆ‘ä»¬é€šå¸¸æŠŠè¿™ä¸ªæ–¹æ³•æœ‰ä¸ªæ›´ä¼˜é›…çš„åå­—æ¥å®šä¹‰å®ƒ`useXXXX`,ä¹Ÿå°±æ˜¯ç±»æ¯” react ä¸­çš„`hook`

```javascript
// hooks/index.ts
import { reactive, toRefs, computed } from '@vue/composition-api';
import i18n from '@/i18n/index';
import { commonRegexp } from '@/utils/index';

// stepè¿›åº¦æ¡
export const useStepConfig = () => {
  const setUpConfig = reactive({
    currentStep: 0,
    steps: [
      {
        value: 1,
        label: computed(() => i18n.t('register.steps.one')),
      },
      {
        value: 2,
        label: computed(() => i18n.t('register.steps.two')),
      },
      {
        value: 3,
        label: computed(() => i18n.t('register.steps.three')),
      },
    ],
  });
  return {
    ...toRefs(setUpConfig),
  };
};
// è´¦å·æ³¨å†Œ
export const useRegister = () => {
  const registeConfig = reactive({
    formParams: {
      account: '',
      password: '',
      rpassword: '',
      authCode: '',
      agreeAndComply: true,
      useServer: '',
    },
    rules: {
      useServer: [
        {
          required: true,
          trigger: 'change',
          validator: (_rule: any, value: string, callback: Function) => {
            if (value === '') {
              callback(new Error(i18n.t('register.registerForm.useServer.message')));
            } else {
              callback();
            }
          },
        },
      ],
      account: [
        {
          required: true,
          trigger: 'blur',
          validator: (_rule: any, value: string, callback: Function) => {
            if (value === '') {
              callback(new Error(i18n.t('register.registerForm.account.emptyMessage')));
            } else if (
              !commonRegexp.MOBILE_REG_EXP.test(value) &&
              !commonRegexp.EMAIL_REG_EXP.test(value)
            ) {
              callback(new Error(i18n.t('register.registerForm.account.message')));
            } else {
              callback();
            }
          },
        },
      ],
      password: [
        {
          required: true,
          validator: (_rule: any, value: string, callback: Function) => {
            if (value === '') {
              callback(new Error(i18n.t('register.registerForm.password.emptyMessage')));
            } else if (!commonRegexp.PASSWORD_REG_EXP.test(value)) {
              callback(new Error(i18n.t('register.registerForm.password.regCheckMessage')));
            } else {
              callback();
            }
          },
          trigger: 'blur',
        },
      ],
      rpassword: [
        {
          required: true,
          validator: (_rule: any, value: string, callback: Function) => {
            if (value === '') {
              callback(new Error(i18n.t('register.registerForm.rpassword.emptyMessage')));
            } else if (value !== registeConfig.formParams.password) {
              callback(new Error(i18n.t('register.registerForm.rpassword.notMatchMessage')));
            } else {
              callback();
            }
          },
          trigger: 'blur',
        },
      ],
      authCode: [
        {
          required: true,
          validator: (_rule: any, value: string, callback: Function) => {
            if (value === '') {
              callback(new Error(i18n.t('register.registerForm.authCode.emptyMessage')));
            } else {
              callback();
            }
          },
          trigger: 'blur',
        },
      ],
    },
  });
  return {
    ...toRefs(registeConfig),
  };
};
// ä¿¡æ¯å¡«å†™
export const userRegistInfo = () => {
   ...
   return {

   }
}
```

è¿™ä¸ª`hook`æ–‡ä»¶å·²ç»æŠŠä¸‰ä¸ªæ­¥å¥ç”¨åˆ°çš„æ•°æ®å±‚å·²ç»é«˜åº¦çš„åˆ†ç¦»äº†å‡ºå»ï¼Œåœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œä½ å¹¶ä¸ä¸€å®šéœ€è¦å†™åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­,å¦‚æœæ¶‰åŠå¤šäººåˆä½œï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠ`index`é‡Œé¢æ‹†åˆ†å¾—æ›´ç»†äº›ï¼Œæ¯”å¦‚è¿™é‡Œä½ å·®åˆ†æˆä¸‰ä¸ªä¸åŒ`ts`æ–‡ä»¶`userRegistInfo.ts`ã€`useRegister.ts`ã€`useStepConfig.ts`ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸€å—è‡ªå·±éœ€è¦æ•°æ®å†™å…¥è‡ªå·±ç›¸å…³çš„`hooks`ä¸­ï¼Œè¿™æ ·æ¯ä¸ªäººåªéœ€è¦ç»´æŠ¤è‡ªå·±é‚£ä»½ä»£ç å°±è¡Œã€‚

çœ‹åˆ°è¿™é‡Œä½ æ˜¯å¦æ„Ÿå—åˆ°`composition-api`çš„æ€æƒ³å‘¢ï¼Œåœ¨`vue3`ä¸­ï¼Œæ‰€æœ‰çš„`api`ç”¨æ³•å‡ ä¹ä¸`composition-api`ç”¨æ³•ä¸€æ ·ï¼Œåœ¨å®˜æ–¹æœ‰è¿™ä¹ˆä¸€æ®µè¯,`å½“è¿ç§»åˆ° Vue 3 æ—¶ï¼Œåªéœ€ç®€å•çš„å°† @vue/composition-api æ›¿æ¢æˆ vue å³å¯ã€‚ä½ ç°æœ‰çš„ä»£ç å‡ ä¹æ— éœ€è¿›è¡Œé¢å¤–çš„æ”¹åŠ¨ã€‚`ã€‚çœ‹åˆ°è¿™é‡Œï¼Œä½ æƒ…ä¸è‡ªç¦çš„å‘å‡ºå°–å«ï¼Œ`vue3`å‘ä¸‹å…¼å®¹äº†`vue2`,å¹¶ä¸”å½“ä½ ç”¨`composition-api`è¿‡æ¸¡`vue3`æ—¶ï¼Œæˆ‘åªéœ€è¦å…¨å±€æ›¿æ¢ä¸€ä¸‹`@vue/composition-api`è¿™ä¸ªå°±å¯ä»¥å…¨é‡å‡çº§åˆ°`vue3`äº†ã€‚

æ­¤æ—¶ä½ å¿ƒä¸­æœ‰æ²¡æœ‰è¢«éœ‡æƒŠåˆ°ï¼Œèµ¶ç´§å‡çº§ä½ é¡¹ç›®çš„`vue2`,è®©ä½ è‡ªå·±åœ¨`vue2`çš„é¡¹ç›®ä¸­ä¹Ÿèƒ½ç•…æ¸¸`vue3`çš„å„ç§å§¿åŠ¿ï¼Œå“ˆå“ˆã€‚
![](https://img.soogif.com/8CMCL0jH4GcLNpUTiyKs5HqxDhRm4JHv.gif?scope=mdnice)

### æ€»ç»“

1.åœ¨ vue2 ä¸­ä½¿ç”¨`options`é¢æ¡æ–¹å¼ç¼–ç ï¼Œä¸šåŠ¡é¡µé¢æœ‰å†—ä½™ä»£ç ï¼Œå½“æˆ‘ä»¬å‘ç°å­—æ®µè®¾è®¡ä¸äº¤äº’æœ‰å·®åˆ«æ—¶ï¼Œå¯ä»¥ä¸äº§å“è®¾è®¡æ²Ÿé€šï¼Œç”¨ä½ çš„ç†ç”±è¯´æœä»–

2.åœ¨ vue2 ä¸­ç”¨`composition-api`æ–¹å¼ç»„ç»‡ä½ çš„ä¸šåŠ¡ä»£ç æ—¶ï¼Œæ˜æ˜¾æ„Ÿå—åˆ°ä¸šåŠ¡é€»è¾‘æ¯”ä»¥å‰æ›´æ¸…æ™°ï¼Œå¹¶ä¸”å¤©ç„¶æ”¯æŒ`ts`,è®©ä½ çš„ä»£ç æ›´å®‰å…¨ï¼Œæ›´å¼ºå£® ğŸ’ª

3.ç±»ä¼¼ react çš„`hook`æ€æƒ³ï¼Œé«˜åº¦è§£è€¦ä¸šåŠ¡è§†å›¾å±‚çš„æ•°æ®é€»è¾‘ï¼Œè®©ä½ æ›´ä¸“æ³¨è§£å†³ç–‘éš¾æ‚ç—‡ï¼Œæˆ–è€…æœ‰æ›´å¤šçš„æ—¶é—´è½»æ¾èŠå¤©å–èŒ¶æ‘¸é±¼ã€‚

4.æ›´å¤šå…³äº[composition-api](https://github.com/vuejs/composition-api/blob/main/README.zh-CN.md 'composition-api'),æ›´å¤š vue3 å‚è€ƒ[å®˜ç½‘](https://v3.cn.vuejs.org/guide/composition-api-introduction.html 'å®˜ç½‘')
